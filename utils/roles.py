# utils/roles.py

# Официальные допустимые роли (ключ — сокращение)
VALID_ROLES = {
    'к': 'Дежурный по курсу',
    'дк': 'Дежурный по курсу',
    'с': 'Дежурный по столовой',
    'дс': 'Дежурный по столовой',
    'ад': 'Административный корпус',
    'гбр': 'Группа быстрого реагирования',
    'зуб': 'Загородная учебная база',
    'з': 'Загородная учебная база',
    'п': 'Патруль',
    'ото': 'Отдел тылового обеспечения',
    'б': 'Буфет',
    'кпп': 'Контрольно-пропускной пункт',
    'пди': 'Помощник дежурного по институту',
    'ос': 'Офицерская столовая',
}

# Значения, которые НЕ считаются ошибками, но не являются нарядами
IGNORED_VALUES = {
    'отпуск',
    'праздник',
    'праздники',
    'выходной',
    'больничный',
    'болен',
    'командировка',
    'уво',
    'отгул',
    '0',
    '',
    'nan',
}

# Краткие названия для интерфейса (например: "С", "К", "АД")
ROLE_SHORT_NAMES = {
    'к': 'К',
    'дк': 'К',
    'с': 'С',
    'дс': 'С',
    'ад': 'АД',
    'гбр': 'ГБР',
    'зуб': 'ЗУБ',
    'з': 'ЗУБ',
    'п': 'П',
    'ото': 'ОТО',
    'б': 'Б',
    'кпп': 'КПП',
    'пди': 'ПДИ',
    'ос': 'ОС',
}

# Все допустимые значения: роли + игнорируемые
VALID_VALUES = set(VALID_ROLES.keys()) | IGNORED_VALUES

def validate_duty_role(value: str) -> tuple[bool, str]:
    """
    Проверяет, является ли значение корректной ролью.
    
    Возвращает: (is_valid, status)
    status: 'valid', 'ignored', 'invalid'
    """
    if not isinstance(value, str):
        value = str(value)
        
    value_lower = value.strip().lower()
    
    if value_lower in IGNORED_VALUES:
        return True, 'ignored'
    elif value_lower in VALID_ROLES:
        return True, 'valid'
    else:
        return False, 'invalid'

def get_role_display(role: str) -> str:
    """
    Возвращает краткое имя роли для отображения.
    Если нет — возвращает в верхнем регистре.
    """
    return ROLE_SHORT_NAMES.get(role.lower(), role.upper())

def get_full_role_name(role: str) -> str:
    """
    Возвращает полное название роли.
    Если не найдено — возвращает "Неизвестно"
    """
    return VALID_ROLES.get(role.lower(), "Неизвестно")
