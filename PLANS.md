# План доработок (структура, без реализации)

Краткий план, чтобы не потерять идеи. Реализация — по шагам.

---

## 1. Опрос (реализовано)

- **Этап 1**: 6 пар основных нарядов (Курс, ГБР, Столовая, ЗУБ). В каждой паре подпись «A vs B» и вопрос «Какой наряд сложнее?»
- **Этап 2**: 6 объектов столовой (Горячий цех, Овощной цех, Стаканы, Железо, Лента, Тарелки) — **13 случайных пар**. Вопрос «Какой объект сложнее?» (сравниваем объекты, не наряды).

---

## Напоминания о задачах (как работают)

- Напоминание **отправляет Telegram-бот** в момент времени `deadline` (файл `handlers/task_reminders.py`).
- Приложение только сохраняет `deadline` через API; бот при запуске восстанавливает отложенные напоминания (`restore_task_reminders`) и раз в 30 сек проверяет задачи (`check_task_reminders`).
- Если сообщение не приходит: 1) бот должен быть запущен; 2) job_queue активна; 3) пользователь не блокировал бота; 4) **время на сервере** — напоминание срабатывает в момент дедлайна по времени сервера (где крутится бот). Например, если завести 00:30, напоминание придёт когда на сервере будет 00:30. Окно проверки расширено до ±60 сек.

---

## 2. Отдельный опрос для девушек (план)

- В регистрации уже есть **пол (женский)** — по нему отсев: девушки не участвуют в опросе юношей.
- У девушек **3 наряда**: ПУТСО, Столовая, Медчасть.
- Схема та же: попарное сравнение, все возможные пары (3 пары).
- Отдельный «опросник» для женского пола, те же механики (веса, рейтинг).

---

## 3. Модуль «Опрос» (полноценная функция — план)

- **Активные опросы**: видны списком.
  - Системные (для работы нарядов): опрос юношей, опрос девушек — всегда 2 таких.
  - Дополнительные: может создать **сержант** (для своей группы) или **помощник** (для всего курса).
- Немного «демократии», но без перебора.
- **Завершение опроса**: результат показывается, когда опрос считается завершённым.
  - Кто может завершить досрочно (например, помощник/админ).
  - Возможность задать время окончания опроса.
- **Визуализация результатов**: что кому присвоено, сколько голосов, гистограмма и т.п. — после завершения.

---

## 4. Роли и панели (реализовано в Mini App)

- **Профиль**: в шапке выводится ФИО, курс, группа, **роль** (Курсант / Сержант / Помощник / Администратор). По нажатию на аватар/блок с данными открывается экран **«Мои данные»**: редактирование ФИО и группы, кнопки «Админ-панель» (для админа) и «Панель помощника» (для помощника).
- **Админ-панель**: список зарегистрированных пользователей; фильтр по курсу (год набора), поиск по ФИО; назначить помощником, назначить сержантом, снять должность.
- **Панель помощника**: тот же список (в рамках своего курса), только назначение/снятие **сержанта** (помощника назначает только админ).
- **Завершение опроса**: в разделе «Опрос» у админа и помощника отображается блок «Завершить опрос» — подсчёт весов и завершение текущего раунда (API `POST /api/survey/finalize`).

| Роль      | Где в интерфейсе | Функции |
|----------|-------------------|---------|
| **Админ** | Профиль → Админ-панель | Список пользователей (курс, группа, поиск по ФИО), назначение/снятие помощника и сержанта. |
| **Помощник** | Профиль → Панель помощника | Список пользователей своего курса, назначение/снятие сержанта. |
| **Сержант** | Отдельной панели нет. | Только в разделе **Наряды**: загрузка/редактирование графика для своей группы. |

---

## 5. Что не трогаем пока

- Детальный UI панелей (админ, помощник).
- Где именно «втюхать» меню помощника при 5 пунктах в быстрой панели.
- Дополнительные функции помощника/сержанта — по мере появления структуры.

---

*Документ обновлён под текущее понимание. Реализация — поэтапно.*
