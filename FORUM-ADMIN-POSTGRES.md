# Форум, админ-панель, подсказки, PostgreSQL

## 1. Форум — внутреннее сообщество курсантов

### Идея
- **Доступ:** только по авторизации через Apex (когда будет). Среда только для курсантов: преподавателям доступ к функциям форума ограничить (не читать, не писать).
- **Анонимность:** при создании темы/поста пользователь сам выбирает — **анонимно** (галочка) или **от своего лица**. Анонимный вход чтобы снизить страх быть «объектом разговора».

### Разделы (боковая панель внутри модуля «Форум»)
| Раздел | Описание |
|--------|----------|
| Творческая галерея | Рисунки, стихи, фотографии |
| Барахолка | Потерял/приобрёл, «нужен галстук», условия — не торговля |
| Доска объявлений | Объявления для курсантов |
| Помощь по учёбе | Вопросы по предметам, материалы |
| Общие обсуждения | Обмен информацией, обсуждения |

### Модерация
- Кнопка **«Пожаловаться»** у темы/поста.
- При **3+ жалобах** по одной теме/посту — уведомление админу, тема уходит в очередь на проверку (скрыть или оставить решает админ).
- Админ не видит, кто написал анонимный пост (хранить только флаг `is_anonymous`, не светить авторство в интерфейсе модерации по желанию).

### Реализация (по шагам)
1. **Сейчас:** на сайте добавлен пункт «Форум» в верхнее меню, модуль с боковой панелью и заглушками разделов, текст про анонимность и только курсантов.
2. **Дальше:** БД (таблицы форума: категории, темы, посты, жалобы), API (список тем, создание темы с галочкой «Анонимно», посты, жалобы), проверка роли при входе (курсант — ок, преподаватель — ограничить).
3. После ответа Apex: проверка «это курсант» по данным Apex и ограничение доступа преподавателей к форуму.

---

## 2. Админ-панель в профиле

- **Где:** в профиле пользователя (клик по аватару/имени в шапке) — экран/модалка «Профиль» с данными и кнопкой **«Админ-панель»**.
- **Кто видит:** только если `role === 'admin'` (из API `/api/user` возвращается `role`).
- **Функционал:** список зарегистрированных курсантов (как в приложении), выдача ролей для работы на сайте: Администратор, Помощник, Сержант, Курсант. Используются существующие API: `GET /api/users?actor_telegram_id=...`, `POST /api/users/set-role`.

---

## 3. Подсказки / описание функций

- **Где:** в модуле «Наряды» — краткие наставления там, где нужно понимание (без лишнего текста).
- **Примеры:**
  - В разделе **«График»:** блок «Как загрузить график» — шаги: скачать шаблон, заполнить ФИО и наряды по дням, загрузить файл в боте или на сайте.
  - В разделе **«Шаблон»:** тот же текст коротко + кнопка скачивания.

---

## 4. Переход на PostgreSQL (для сайта)

### Зачем
- Надёжность и масштаб в долгосроке, удобнее бэкапы и реплики.
- Бот можно оставить на SQLite (отдельный процесс, мало данных). Сайт и общий API перевести на PostgreSQL.

### Варианты
| Вариант | Описание |
|---------|----------|
| A | Один backend (FastAPI): подключение к PostgreSQL; бот и сайт ходят в одну БД. SQLite не использовать. |
| B | Два хранилища: бот — SQLite (как сейчас), сайт — отдельный backend или те же роуты, но чтение/запись в PostgreSQL. Синхронизация пользователей при первом входе с сайта (копировать из SQLite в PostgreSQL или наоборот) — сложнее. |

**Рекомендация:** вариант A — один backend, одна БД PostgreSQL. Бот продолжает слать напоминания и открывать Mini App; регистрация и все данные (пользователи, наряды, опросы, позже форум) — в PostgreSQL. Миграция: выгрузить данные из SQLite (users, duty_schedule, duty_objects, notifications, tasks и т.д.), загрузить в PostgreSQL по той же схеме, переключить `server.py` на `psycopg2` или `asyncpg`, задать `DATABASE_URL` в окружении.

### Шаги миграции (когда будете готовы)
1. Создать БД PostgreSQL, схему таблиц (аналог текущих в `database.py`).
2. Скрипт миграции: чтение из SQLite, запись в PostgreSQL.
3. В `server.py` заменить `sqlite3` на подключение к PostgreSQL (через конфиг/env).
4. Прогнать сценарии: регистрация, наряды, опрос, уведомления, рейтинг.
5. Бота оставить как есть (тот же API), только БД общая — PostgreSQL.

Документ можно дополнять по мере реализации форума и миграции БД.
